<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        !function(e,t,n){e.yektanetAnalyticsObject=n,e[n]=e[n]||function(){e[n].q.push(arguments)},e[n].q=e[n].q||[];var a=t.getElementsByTagName("head")[0],r=new Date,c="https://cdn.yektanet.com/superscript/jxhT0m91/native-plasecweb.darkube.app-40189/yn_pub.js?v="+r.getFullYear().toString()+"0"+r.getMonth()+"0"+r.getDate()+"0"+r.getHours(),s=t.createElement("link");s.rel="preload",s.as="script",s.href=c,a.appendChild(s);var l=t.createElement("script");l.async=!0,l.src=c,a.appendChild(l)}(window,document,"yektanet");
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLasec</title>
    
    {% load static %}
    
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="{% static 'js/app.js' %}"></script>

    <style>
        body.dark-theme {
            background-color: #121212;
            color: white;
        }

        .message {
            cursor: pointer;
            padding: 10px;
            border-bottom: 1px solid #333;
        }

        .message:hover {
            background-color: #2c2c2c;
        }

        #searchBar {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            background-color: #2c2c2c;
            border: 1px solid #444;
            color: white;
        }
        #messageInput{
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            background-color: #2c2c2c;
            border: 1px solid #444;
            color: white;
        }
        /* ChatGPT dark theme button styling */
.button {
    background-color: #3f3f46; /* Dark gray background for button */
    color: #e5e5e5; /* Light gray text color */
    padding: 8px 16px;
    font-size: 14px;
    font-weight: 500;
    border: none;
    border-radius: 6px; /* Rounded corners for a modern look */
    cursor: pointer;
    transition: background-color 0.3s ease; /* Smooth hover transition */
}

.button:hover {
    background-color: #575767; /* Darker gray on hover */
}

.button:active {
    background-color: #404040; /* Slightly different shade on click */
}

.button-container {
    text-align: left;
    margin: 10px 0;
}
/* Base styles for .btn-primary.custom-button */
.btn-primary.custom-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #6b7280; /* Default text color (gray) */
    background-color: transparent; /* Transparent background for base state */
    border: 1px solid transparent;
    border-radius: 6px; /* Rounded corners */
    transition: all 0.3s ease; /* Smooth transition for hover effects */
    cursor: pointer;
}
.custom-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #6b7280; /* Text color */
    background-color: transparent; /* Transparent background for base state */
    border: 1px solid transparent;
    border-radius: 6px; /* Rounded corners */
    transition: all 0.3s ease; /* Smooth transition for hover effects */
    cursor: pointer;
}

.custom-button:hover {
    color: #10b981; /* Change text color on hover (green) */
    background-color: #1f2937; /* Subtle background on hover */
    border: 1px solid #10b981; /* Add border on hover */
}

.custom-button:active {
    background-color: #374151; /* Slightly darker background on click */
    color: #ffffff; /* White text on click */
}
.btn-primary {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 500;
    
    color: #ffffff; /* Text color */
    background-color: transparent; /* Transparent background for base state */
    border: 2px solid transparent;
    border-color: #050505;
    border-radius: 6px; /* Rounded corners */
    transition: all 0.3s ease; /* Smooth transition for hover effects */
    cursor: pointer;
}
/* Mobile adjustments */
@media (max-width: 768px) {
    .btn-primary {
        padding: 8px 16px; /* Reduce padding for smaller screens */
        font-size: 12px; /* Smaller font size for better fit */
        border-radius: 4px; /* Slightly smaller rounded corners */
         color: #10b981; /* Change text color on hover (green) */
    background-color: #1f2937; /* Subtle background on hover */
    border: 1px solid #10b981; /* Add border on hover */
    }
}
.btn-primary:hover {
    color: #10b981; /* Change text color on hover (green) */
    background-color: #1f2937; /* Subtle background on hover */
    border: 1px solid #10b981; /* Add border on hover */
}

.btn-primary:active {
    background-color: #374151; /* Slightly darker background on click */
    color: #ffffff; /* White text on click */
}

 
    </style>
</head>
<script type="text/javascript" src="jquery-2.2.2.min.js"></script>
<script type="text/javascript">
      $(document).ready(function(){
              $("messageInput").keyup(function(){
                  alert("hi");
              });
      });

      function sendCode(){
           document.getElementById("output").innerHTML =
           document.getElementById("input").value;
      }
</script>
<body class="dark-theme">
    <div class="container mt-5">
        <h2 class="text-center"><p>Plasec<!-- Search bar for filtering messages -->
            <div style="display: flex; align-items: center; ">
                <input type="text" id="searchBar" placeholder="Search messages..." onkeyup="searchMessages()" style="flex: 1;">
                <button id="searchToggle" style="background: none; border: none; margin-left: 10px; cursor: pointer;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"   fill="#32a84a"  viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.099zm-5.44-8.67a5.5 5.5 0 1 1 0 11 5.5 5.5 0 0 1 0-11z" />
                    </svg>
                </button>
            </div>
            <!-- Form to send messages --></p></h2>

        
        <form method="POST" class="mt-4">
            {% csrf_token %}
            <div class="mb-3">
                <textarea onkeyup="searchMessages()" id="messageInput" name="message" class="form-control" placeholder="Type your message here..." rows="3" width="100%"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Send</button>
            <button type="button" class="btn btn-primary" onclick="searchMessages()">Image</button>

        </form>

 
        <!-- Messages -->
        <h3 class="text-center">Messages</h3>
        <div class="messages mt-4">
            {% for message in messages %}
                {% if message.message and "error" not in message.message.lower and message.message != '' %}
                    <!-- Each Play button has a unique class and data attribute for identifying the message -->
                   

                    <hr>  

                    <pre id="blockchainDisplay"></pre>
                    <div class="message" onclick="messageClicked('{{ message.id }}')">
                        <strong>User:</strong> {{ message.message }}<br>
                        <strong>Output:</strong><div id="respond">{{ message.response }}</div> <br>
                        <strong>Timestamp:</strong> {{ message.timestamp }}
                        {% if message.topic != 'default_topic' %}
                            <br><strong>Topic:</strong> {{ message.topic }}
                        {% endif %}
                        {% if message.system != 'default_system' %}
                            <br><strong>System:</strong> {{ message.system }}
                        {% endif %}
                        Plasec: {{ message.score }}
                    </div>
                {% endif %}
                <div class="button-container">
                    <button class="playButton btn btn-primary" data-message-id="{{ 1 }}">
                       Share
                    </button>   
                    <button class="playButton btn btn-primary" data-message-id="{{ 2 }}">
                        Play
                    </button>
                    
                                          
                </div>
            {% endfor %}
        </div>
        
    </div>
  
    <script>
        function navigateToUrl(url) {
    window.location.href = url;
}

        function searchMessages() {
        searchbar=document.getElementById("messageInput").innerHTML
        let messageInput = searchBar.value.toLowerCase().trim();
        let messages = document.getElementsByClassName("messages mt-4");
        searchBar = document.getElementById("searchBar");
 
        
        Array.from(messages).forEach(function(message) {
            let text = message.textContent.toLowerCase().trim();

            console.log("Message text:", text);  // Log the text of each message for debugging

            // Show the message if it matches the search input, is not empty, and does not contain "blockchain data"
            if (text.includes(messageInput) && text.length > 0 && text !== "blockchain data") {
                message.style.display = "";  // Show message
            } else {
                message.style.display = "none";  // Hide message
            }
        });
    }
        /// Select all buttons with the "playButton" class and add event listeners to each
document.addEventListener("DOMContentLoaded", function() {
    
    const playButtons = document.querySelectorAll(".playButton");
    const startButtons = document.querySelectorAll(".startButton");
    const searchBar = document.getElementById("searchBar");
    searchBar.style.display = "none";
   
    if (searchBar) {
        searchBar.addEventListener("keyup", searchMessages);
    } else {
        console.error("Search bar element not found.");
    }
    const searchToggle = document.getElementById("searchToggle");
 
    searchToggle.addEventListener("click", function() {
        if (searchBar.style.display === "none" || searchBar.style.display === "") {
            searchBar.style.display = "block";
            searchBar.focus(); // Focus on the input when shown
        } else {
            searchBar.style.display = "none";
        }
    });
    
 
    
    startButtons.forEach(button => {
        button.addEventListener("click", function() {
            window.location.href = "http://plasecweb.darkube.app/play_in_telegram/11111/";
        });
    });
       
  
    playButtons.forEach(button => {
        button.addEventListener("click", function() {
            textcontent="click $$$underlineplay"
            
            messageId=button.getAttribute("data-message-id")
       if(messageId==1)
         textcontent= document.getElementById("respond").innerHTML
            messageId=textcontent
            window.location.href ='https://plasecweb.darkube.app/play_in_telegram/'+messageId+'/';
 // Redirect back to the home page after 3 seconds
 setTimeout(function() {
            window.location.href = 'https://plasecweb.darkube.app/';  // Replace '/' with your desired URL
        }, 3000);
        });
    });
 
});


        function deleteMessage(messageId) {
            fetch(`/delete_message/${messageId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Message deleted successfully!');
                    location.reload();  // Reload the page to update the message list
                } else {
                    alert('Error deleting message: ' + data.message);
                }
            });
        }

        function messageClicked(messageId) {
            fetch(`/message_clicked/${messageId}/`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert('Message clicked! New score: ' + data.new_score);
                    } else {
                        alert('Error: ' + data.message);
                    }
                });
        }

        function fetchBlockchain() {
            fetch('/get_blockchain/')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('blockchainDisplay').textContent = JSON.stringify(data, null, 4);
                });
        }
    </script>
    <div id="pos-article-display-102291"></div>
</body>
</html>
